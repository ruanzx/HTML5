/*
 *
 * SpreadJS Library 8.40.20151.0
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 *
 * Licensed under the SpreadJS Commercial License. 
 * spread.sales@grapecity.com
 * http://spread.grapecity.com/Pages/Spread-JS-License/
 *
 *
 **/
var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},GcSpread;(function(n){(function(n){var ri,pt,v,rt,ut,c,wt,ft,y;n.feature("floatingObject",["core.common","core.stringResource","core.sheet_action","core.imageLoader"]);var i=null,t=undefined,ui="string",fi="number",e=Math.ceil,s=Math.floor,l=Math.max,r=Math.min,u=Math.abs,et="#044062",ei=0,h=1,oi=2,ot=9007199254740992,bt=700,kt=701,p="position",w="absolute",st="100%",ht="background",si="background-image",ct="floatingobject-selected",lt="floatingobject-unselected",f="floatingobject-resize-indicator-select",b="floatingobject-resize-indicator-unSelect",o="floatingobject-none-user-select",a="floatingobject-content-container",dt="floatingobject-container",gt="floatingobject-moving-container",ni="floatingobject-moving-div",ti="floatingobject-background-cover",at=".floatingobject-resize-indicator",k="div.floatingobject-resize-indicator.floatingobject-top.floatingobject-left",d="div.floatingobject-resize-indicator.floatingobject-middle.floatingobject-left",g="div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-left",vt="div.floatingobject-resize-indicator.floatingobject-top.floatingobject-center",yt="div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-center",nt="div.floatingobject-resize-indicator.floatingobject-top.floatingobject-right",tt="div.floatingobject-resize-indicator.floatingobject-middle.floatingobject-right",it="div.floatingobject-resize-indicator.floatingobject-bottom.floatingobject-right",ii='<div class="floatingobject-resize-indicator floatingobject-top floatingobject-left floatingobject-absolute"><\/div><div class="floatingobject-resize-indicator floatingobject-top floatingobject-center floatingobject-absolute"><\/div><div class="floatingobject-resize-indicator floatingobject-top floatingobject-right floatingobject-absolute"><\/div><div class="floatingobject-resize-indicator floatingobject-middle floatingobject-left floatingobject-absolute"><\/div><div class="floatingobject-resize-indicator floatingobject-middle floatingobject-right floatingobject-absolute"><\/div><div class="floatingobject-resize-indicator floatingobject-bottom floatingobject-left floatingobject-absolute"><\/div><div class="floatingobject-resize-indicator floatingobject-bottom floatingobject-center floatingobject-absolute"><\/div><div class="floatingobject-resize-indicator floatingobject-bottom floatingobject-right floatingobject-absolute"><\/div>',hi="input",ci=".gcFloatingObject";(function(n){n[n.CustomFloatingObject=0]="CustomFloatingObject";n[n.Picture=1]="Picture"})(n.FloatingObjectType||(n.FloatingObjectType={}));ri=n.FloatingObjectType;pt=function(r){function u(n){r.call(this);this._floatingObjectType=i;var t=this;t._sheet=n;t._bindEventsOnSheet()}return __extends(u,r),u.prototype.ownerSheet=function(n){return arguments.length===0?this._sheet:(this._sheet=n,this)},u.prototype.find=function(n){var t=this._findItemIndex(n);return t>=0?this[t]:i},u.prototype.replace=function(r,u){if(u===i||u===t)throw new Error(n.SR.Exp_ValueIsNull);var f=this._findItemIndex(r);f>=0&&this.splice(f,1,u)},u.prototype.add=function(r){var u=r.name();if(u===i||u===t)throw new Error(n.SR.Exp_FloatingObjectNameEmptyError);this._checkObjectExists(u);r.owner(this._sheet);this.push(r)},u.prototype.remove=function(n){if(n!==i&&n!==t){var r=this._findItemIndex(n.name());return r>=0&&n.owner(i),this.splice(r,1),!0}return!1},u.prototype.addRows=function(n,t){for(var i=0,r=this.length;i<r;i++)this[i].addRows(n,t)},u.prototype.removeRows=function(n,t){for(var u=this,e=[],r,i=0,f=u.length;i<f;i++)r=u[i],u._isCoverRange(n,-1,n+t-1,u._sheet.getColumnCount(),r)&&(r.dynamicMove()||r.dynamicSize())?e.push(r):r.removeRows(n,t);for(i=0,f=e.length;i<f;i++)u.remove(e[i])},u.prototype.addColumns=function(n,t){for(var i=0,r=this.length;i<r;i++)this[i].addColumns(n,t)},u.prototype.removeColumns=function(n,t){for(var u=this,e=[],r,i=0,f=u.length;i<f;i++)r=u[i],u._isCoverRange(-1,n,u._sheet.getRowCount(),n+t-1,r)&&(r.dynamicMove()||r.dynamicSize())?e.push(r):r.removeColumns(n,t);for(i=0,f=e.length;i<f;i++)u.remove(e[i])},u.prototype._isCoverRange=function(n,t,i,r,u){var f=u.startRow(),e=u.startColumn(),o=u.endRow(),s=u.endColumn();return n<=f&&t<=e&&i>=o&&r>=s},u.prototype._checkObjectExists=function(t){if(this._sheet._findFloatingObjectInternal(t))throw new Error(n.SR.Exp_FloatingObjectHasSameNameError);},u.prototype._findItemIndex=function(n){for(var i=this.length,t=0;t<i;t++)if(this[t].name()===n)return t;return-1},u.prototype._updateFloatingsObjectlayoutOnColumnRowChanged=function(){for(var n,t=0,i=this.length;t<i;t++)n=this[t],n.dynamicMove()?n._updateFloatingObjectLocation():n._updateStartPosition(),n.dynamicSize()?n._updateFloatingObjectSize():n._updateEndPosition()},u.prototype._bindEventsOnSheet=function(){var i=this,t=i._sheet;t&&($(window.document.body).scroll(function(){var n=t.parent.getActiveSheet(),i=n._render,r=n._floatingObjectArray;r&&r.length>0&&i&&i._paintFloatingObject(n._bounds)}),t._bind(n.Events.ColumnChanged,function(n,t){var r=t.propertyName;(r==="width"||r==="isVisible")&&i._updateFloatingObjectsLayout()}),t._bind(n.Events.RowChanged,function(n,t){var r=t.propertyName;(r==="height"||r==="isVisible")&&i._updateFloatingObjectsLayout()}),t._bind(n.Events.ColumnWidthChanged,function(n,t){i._updateFloatingObjectsLayout()}),t._bind(n.Events.RowHeightChanged,function(n,t){i._updateFloatingObjectsLayout()}))},u.prototype._updateFloatingObjectsLayout=function(){var n=this,t=n._sheet,i=t._render;n.length>0&&(n.isNeedToUpdateLayout=!0,i&&i._paintFloatingObject(t._bounds))},u.prototype.toJSON=function(){var n=this,i,r;if(!n||n.length===0)return t;for(i=[],r=0;r<n.length;r++)i.push(n[r].toJSON());return i.length===0?t:i},u.prototype.fromJSON=function(n,t){var e=this,u,f,r,s,o;if(n&&n.length!==0)for(u=0;u<n.length;u++)f=n[u],r=i,f&&(s=e._getFloatingObjectTypes(),o=s[f.floatingObjectType],o&&(r=new o,r.owner(e._sheet),r.fromJSON(f,t),e.push(r)))},u.prototype._getFloatingObjectTypes=function(){if(!this._floatingObjectType){var n={};n[0]=rt;n[1]=ut;this._floatingObjectType=n}return this._floatingObjectType},u}(n._XArray);n._FloatingObjectArray=pt;v=function(){function r(i,r,u,f,e){this._cacheOffset={startRowOffset:t,startColumnOffset:t,endRowOffset:t,endColumnOffset:t};this._isFOColumnsOrRowsVisible=!0;var o=this;o._name=i;o._location=new n.Rect(typeof r=="number"?r:0,typeof u=="number"?u:0,typeof f=="number"?f:0,typeof e=="number"?e:0);o._canPrint=!0;o._isLocked=!0;o._isVisible=!0;o._isSelected=!1;o._dynamicMove=!0;o._dynamicSize=!0}return r.prototype.name=function(t){var i=this;if(arguments.length===0)return i._name;if(typeof t!="string"||t==="")throw new Error(n.SR.Exp_FloatingObjectNameEmptyError);return i._name!==t&&(i._name=t,i._trigger({sheet:i._sheet,sheetName:i._sheet?i._sheet._name:"",floatingObject:i,propertyName:"name"})),i},r.prototype.owner=function(n){var t=this;return arguments.length===0?t._sheet:(t._sheet=n,t._updateFloatingObjectCoorinates(),t)},r.prototype.isSelected=function(n){var t=this,i=t._sheet;return arguments.length===0?t._isSelected:(typeof n=="boolean"&&t._isSelected!==n&&(i?i._bindToAutoRefresh(function(n){t._isSelected=n})(n):t._isSelected=n,t._trigger({sheet:i,sheetName:i?i._name:"",floatingObject:t,propertyName:"isSelected"})),t)},r.prototype.isLocked=function(n){var t=this;return arguments.length===0?t._isLocked:(typeof n=="boolean"&&t._isLocked!==n&&(t._isLocked=n,t._trigger({sheet:t._sheet,sheetName:t._sheet?t._sheet._name:"",floatingObject:t,propertyName:"islocked"})),t)},r.prototype.canPrint=function(n){var t=this;return arguments.length===0?t._canPrint:(typeof n=="boolean"&&t._canPrint!==n&&(t._canPrint=n,t._trigger({sheet:t._sheet,sheetName:t._sheet?t._sheet._name:"",floatingObject:t,propertyName:"canPrint"})),t)},r.prototype.isVisible=function(n){var t=this,i=t._sheet;return arguments.length===0?t._isVisible:(typeof n=="boolean"&&t._isVisible!==n&&(i?i._bindToAutoRefresh(function(i){t._isVisible=n})(n):t._isVisible=n,t._trigger({sheet:i,sheetName:i?i._name:"",floatingObject:t,propertyName:"visible"})),t)},r.prototype.position=function(t){var i=this,r=i._sheet;return arguments.length===0?new n.Point(i._location.x,i._location.y):(t instanceof n.Point&&(i._location.x!==t.x||i._location.y!==t.y)&&(r?r._bindToAutoRefresh(function(n){i._location.x=n.x;i._location.y=n.y;i._adjustPosition();i._updateCoverRange()})(t):(i._location.x=t.x,i._location.y=t.y),i._trigger({sheet:r,sheetName:r?r._name:"",floatingObject:i,propertyName:"position"})),i)},r.prototype.height=function(n){var t=this,i=t._sheet;return arguments.length===0?t._location.height:(typeof n=="number"&&t._location.height!==n&&(i?i._bindToAutoRefresh(function(n){t._location.height=n;t._adjustSize();t._adjustPosition();t._updateCoverRange()})(n):t._location.height=n,t._trigger({sheet:i,sheetName:i?i._name:"",floatingObject:t,propertyName:"height"})),t)},r.prototype.width=function(n){var t=this,i=t._sheet;return arguments.length===0?t._location.width:(typeof n=="number"&&t._location.width!==n&&(i?i._bindToAutoRefresh(function(n){t._location.width=n;t._adjustSize();t._adjustPosition();t._updateCoverRange()})(n):t._location.width=n,t._trigger({sheet:i,sheetName:i?i._name:"",floatingObject:t,propertyName:"width"})),t)},r.prototype.startRow=function(n){var t=this;return arguments.length===0?t._startRow:(typeof n=="number"&&t._startRow!==n&&(n=e(n),t._sheet?t._sheet._bindToAutoRefresh(function(n){t._startRow=n;t._updateFloatingObjectLocation()})(n):t._startRow=n),t)},r.prototype.startRowOffset=function(n){var t=this;return arguments.length===0?t._startRowOffset:(typeof n=="number"&&t._startRowOffset!==n&&(t._sheet?t._sheet._bindToAutoRefresh(function(n){t._startRowOffset=n;t._updateFloatingObjectLocation()})(n):t._startRowOffset=n),t)},r.prototype.startColumn=function(n){var t=this;return arguments.length===0?t._startColumn:(typeof n=="number"&&t._startColumn!==n&&(n=e(n),t._sheet?t._sheet._bindToAutoRefresh(function(n){t._startColumn=n;t._updateFloatingObjectLocation()})(n):t._startColumn=n),t)},r.prototype.startColumnOffset=function(n){var t=this;return arguments.length===0?t._startColumnOffset:(typeof n=="number"&&t._startColumnOffset!==n&&(t._sheet?t._sheet._bindToAutoRefresh(function(n){t._startColumnOffset=n;t._updateFloatingObjectLocation()})(n):t._startColumnOffset=n),t)},r.prototype.endRow=function(n){var t=this;return arguments.length===0?t._endRow:(typeof n=="number"&&t._endRow!==n&&(t._sheet?t._sheet._bindToAutoRefresh(function(n){t._endRow=n;t._updateFloatingObjectSize()})(n):t._endRow=n),t)},r.prototype.endRowOffset=function(n){var t=this;return arguments.length===0?t._endRowOffset:(typeof n=="number"&&t._endRowOffset!==n&&(t._sheet?t._sheet._bindToAutoRefresh(function(n){t._endRowOffset=n;t._updateFloatingObjectSize()})(n):t._endRowOffset=n),t)},r.prototype.endColumn=function(n){var t=this;return arguments.length===0?t._endColumn:(typeof n=="number"&&t._endColumn!==n&&(n=e(n),t._sheet?t._sheet._bindToAutoRefresh(function(n){t._endColumn=n;t._updateFloatingObjectSize()})(n):t._endColumn=n),t)},r.prototype.endColumnOffset=function(n){var t=this;return arguments.length===0?t._endColumnOffset:(typeof n=="number"&&t._endColumnOffset!==n&&(t._sheet?t._sheet._bindToAutoRefresh(function(n){t._endColumnOffset=n;t._updateFloatingObjectSize()})(n):t._endColumnOffset=n),t)},r.prototype.dynamicMove=function(n){var t=this;return arguments.length===0?t._dynamicMove:(typeof n=="boolean"&&t._dynamicMove!==n&&(t._dynamicMove=n,n||(t._dynamicSize=!1),t._trigger({sheet:t._sheet,sheetName:t._sheet?t._sheet._name:"",floatingObject:t,propertyName:"dynamicMove"})),t)},r.prototype.dynamicSize=function(n){var t=this;return arguments.length===0?t._dynamicSize:(typeof n=="boolean"&&t._dynamicSize!==n&&(n&&!t._dynamicMove&&(n=!1),t._dynamicSize=n,t._trigger({sheet:t._sheet,sheetName:t._sheet?t._sheet._name:"",floatingObject:t,propertyName:"dynamicSize"})),t)},r.prototype.addRows=function(n,t){var i=this;n=e(n);t=e(t);n<=i.startRow()?i.dynamicMove()&&(i.startRow(i.startRow()+t),i.endRow(i.endRow()+t)):n>i.startRow()&&n<i.endRow()&&i.dynamicSize()&&i.endRow(i.endRow()+t)},r.prototype.removeRows=function(n,t){var i=this,r=n+t-1,u,f;n<=i.startRow()?r<i.startRow()?i.dynamicMove()&&(i.startRow(i.startRow()-t),i.endRow(i.endRow()-t)):r<i.endRow()&&(u=r-i.startRow()+1,f=i.endRow()-i.startRow()+1-u,i.dynamicMove()&&(i.startRow(n),i.startRowOffset(0)),i.dynamicSize()&&i.endRow(n+f-1)):n<=i.endRow()&&(r<i.endRow()?i.dynamicSize()&&i.endRow(i.endRow()-t):i.dynamicSize()&&(i.endRow(n),i.endRowOffset(0)))},r.prototype.addColumns=function(n,t){var i=this;n=e(n);t=e(t);n<=i.startColumn()?i.dynamicMove()&&(i.startColumn(i.startColumn()+t),i.endColumn(i.endColumn()+t)):n>i.startColumn()&&n<i.endColumn()&&i.dynamicSize()&&i.endColumn(i.endColumn()+t)},r.prototype.removeColumns=function(n,t){var i=this,r,u,f;n=e(n);t=e(t);r=n+t-1;n<=i.startColumn()?r<i.startColumn()?i.dynamicMove()&&(i.startColumn(i.startColumn()-t),i.endColumn(i.endColumn()-t)):r<i.endColumn()&&(u=r-i.startColumn()+1,f=i.endColumn()-i.startColumn()+1-u,i.dynamicMove()&&(i.startColumn(n),i.startColumnOffset(0)),i.dynamicSize()&&i.endColumn(n+f-1)):n<=i.endColumn()&&(r<i.endColumn()?i.dynamicSize()&&i.endColumn(i.endColumn()-t):i.dynamicSize()&&(i.endColumn(n),i.endColumnOffset(0)))},r.prototype._isDefaultValue=function(n,t){switch(n){case"x":return t===0;case"y":return t===0;case"width":return t===0;case"height":return t===0;case"canPrint":return t===!0;case"isSelected":return t===!1;case"isLocked":return t==!0;case"isVisible":return t===!0;case"dynamicMove":return t===!0;case"dynamicSize":return t===!0;default:return!1}},r.prototype.toJSON=function(){var n=this,r={name:n._name,x:n._location.x,y:n._location.y,width:n._location.width,height:n._location.height,canPrint:n._canPrint,isSelected:n._isSelected,isLocked:n._isLocked,isVisible:n._isVisible,dynamicMove:n._dynamicMove,dynamicSize:n._dynamicSize},u={},t,i;for(t in r)i=r[t],n._isDefaultValue(t,i)||(u[t]=i);return u},r.prototype.fromJSON=function(i,r){var u;if(i){u=this;u._name=i.name;var f=i.x!==t?i.x:0,e=i.y!==t?i.y:0,o=i.width!==t?i.width:0,s=i.height!==t?i.height:0;u._location=new n.Rect(f,e,o,s);i.canPrint!==t&&(u._canPrint=i.canPrint);i.isSelected!==t&&(u._isSelected=i.isSelected);i.isLocked!==t&&(u._isLocked=i.isLocked);i.isVisible!==t&&(u._isVisible=i.isVisible);i.dynamicMove!==t&&(u._dynamicMove=i.dynamicMove);i.dynamicSize!==t&&(u._dynamicSize=i.dynamicSize);u._updateCoverRange()}},r.prototype.clone=function(){var n=new r,t=JSON.stringify(this.toJSON());return n.fromJSON(JSON.parse(t)),n},r.prototype._adjustSize=function(){var n=this,t=n._getSheetHeight(),i=n._getSheetWidth();n._location.width>i&&(n._location.width=i);n._location.height>t&&(n._location.height=t)},r.prototype._adjustPosition=function(){var n=this,t=n._getSheetHeight(),i=n._getSheetWidth(),u=n._location.x+n._location.width,r;u>i&&(n._location.x=i-n._location.width);n._location.x<0&&(n._location.x=0);r=n._location.y+n._location.height;r>t&&(n._location.y=t-n._location.height);n._location.y<0&&(n._location.y=0)},r.prototype._updateFloatingObjectCoorinates=function(){var n=this;n._adjustSize();n._adjustPosition();n._startRow!==i&&n._startRow!==t&&n._startColumn!==i&&n._startColumn!==t?(n._startRowOffset||(n._startRowOffset=0),n._startColumnOffset||(n._startColumnOffset=0),n._updateFloatingObjectLocation()):n._updateStartPosition();n._endColumn!==i&&n._endColumn!==t&&n._endRow!==i&&n._endRow!==t?(n._endRowOffset||(n._endRowOffset=0),n._endColumnOffset||(n._endColumnOffset=0),n._updateFloatingObjectSize()):n._updateEndPosition()},r.prototype._getSheetHeight=function(){var e=this,n=e._sheet,u,f,r;if(n===i||n===t)return ot;for(u=0,f=n.getRowCount(),r=0;r<f;r++)u+=n.getRowHeight(r,3);return u},r.prototype._getSheetWidth=function(){var e=this,n=e._sheet,u,f,r;if(n===i||n===t)return ot;for(u=0,f=n.getColumnCount(),r=0;r<f;r++)u+=n.getColumnWidth(r,3);return u},r.prototype._updateStartRowOffset=function(){var n=this,u=n._startRowOffset,i=n._sheet.getRowHeight(n.startRow(),3),r=n._cacheOffset;i>0&&i--;u>i?(r.startRowOffset||(r.startRowOffset=u),n._startRowOffset=i):r.startRowOffset&&(r.startRowOffset<i?(n._startRowOffset=r.startRowOffset,r.startRowOffset=t):i<r.startRowOffset&&(n._startRowOffset=i))},r.prototype._updateStartColumnOffset=function(){var n=this,u=n._startColumnOffset,r=n._sheet.getColumnWidth(n.startColumn(),3),i=n._cacheOffset;r>0&&r--;u>r?(i.startColumnOffset||(i.startColumnOffset=u),n._startColumnOffset=r):i.startColumnOffset&&(i.startColumnOffset<r?(n._startColumnOffset=i.startColumnOffset,i.startColumnOffset=t):u<i.startColumnOffset&&(n._startColumnOffset=r))},r.prototype._updateEndRowOffset=function(){var n=this,u=n._endRowOffset,r=n._sheet.getRowHeight(n.endRow(),3),i=n._cacheOffset;r>0&&r--;u>r?(i.endRowOffset||(i.endRowOffset=u),n._endRowOffset=r):i.endRowOffset&&(i.endRowOffset<r?(n._endRowOffset=i.endRowOffset,i.endRowOffset=t):u<i.endRowOffset&&(n._endRowOffset=r))},r.prototype._updateEndColumnOffset=function(){var n=this,u=n._endColumnOffset,r=n._sheet.getColumnWidth(n.endColumn(),3),i=n._cacheOffset;r>0&&r--;u>r?(i.endColumnOffset||(i.endColumnOffset=u),n._endColumnOffset=r):i.endColumnOffset&&(i.endColumnOffset<r?(n._endColumnOffset=i.endColumnOffset,i.endColumnOffset=t):u<i.endColumnOffset&&(n._endColumnOffset=r))},r.prototype._updateFloatingObjectLocation=function(){var n=this,r=n._sheet,u,s,e,f,h,o;if(r!==i&&r!==t){for(u=0,s=n.startRow(),e=0;e<s;e++)u+=r.getRowHeight(e,3);for(n._updateStartRowOffset(),u+=n._startRowOffset,f=0,h=n.startColumn(),o=0;o<h;o++)f+=r.getColumnWidth(o,3);n._updateStartColumnOffset();f+=n._startColumnOffset;(n._location.x!==f||n._location.y!==u)&&(n._location.x=f,n._location.y=u,n._trigger({sheet:r,sheetName:r?r._name:"",floatingObject:n,propertyName:"location"}))}},r.prototype._updateFloatingObjectSize=function(){var n=this,r=n._sheet,e,a,v,o,y,p;if(r!==i&&r!==t){n._isFOColumnsOrRowsVisible===!1&&(n._isVisible=!0,n._isFOColumnsOrRowsVisible=!0);var u=0,s=n.startRow(),h=n.endRow();for(e=s;e<h;e++)u+=r.getRowHeight(e,3);a=u+r.getRowHeight(h,3);a===0&&n._isVisible===!0&&(n._isVisible=!1,n._isFOColumnsOrRowsVisible=!1);s===h?(n._updateEndRowOffset(),u=n.endRowOffset()-n.startRowOffset()):(v=r.getRowHeight(s,3),v>0&&(u-=n._startRowOffset),n._updateEndRowOffset(),u+=n._endRowOffset);var f=0,c=n.startColumn(),l=n.endColumn();for(o=c;o<l;o++)f+=r.getColumnWidth(o,3);y=f+r.getColumnWidth(l,3);y===0&&n._isVisible===!0&&(n._isVisible=!1,n._isFOColumnsOrRowsVisible=!1);c===l?(n._updateEndColumnOffset(),f=n.endColumnOffset()-n.startColumnOffset()):(p=r.getColumnWidth(c,3),p>0&&(f-=n._startColumnOffset),n._updateEndColumnOffset(),f+=n._endColumnOffset);f<0&&(f=0);u<0&&(u=0);n._location.width!==f&&(n._location.width=f,n._trigger({sheet:r,sheetName:r?r._name:"",floatingObject:n,propertyName:"width"}));n._location.height!==u&&(n._location.height=u,n._trigger({sheet:r,sheetName:r?r._name:"",floatingObject:n,propertyName:"height"}))}},r.prototype._updateStartPosition=function(){var n=this,r=n._sheet,u,f,e,o;r!==i&&r!==t&&(u=n._calcAnchorRow(n._location.y),n._startRow=u.row,n._startRowOffset=u.offsetY,n._startRowOffset===-1&&(n._startRow+=1,n._startRowOffset=0,f=r.getRowCount(),n._startRow===f&&(n._startRow=f-1)),e=n._calcAnchorColumn(n._location.x),n._startColumn=e.column,n._startColumnOffset=e.offsetX,n._startColumnOffset===-1&&(n._startColumn+=1,n._startColumnOffset=0,o=r.getColumnCount(),n._startColumn===o&&(n._startColumn=o-1)))},r.prototype._updateEndPosition=function(){var n=this,r,u;n._sheet!==i&&n._sheet!==t&&(r=n._calcAnchorRow(n._location.y+n._location.height),n._endRow=r.row,n._endRowOffset=r.offsetY,u=n._calcAnchorColumn(n._location.x+n._location.width),n._endColumn=u.column,n._endColumnOffset=u.offsetX)},r.prototype._updateCoverRange=function(){this._updateStartPosition();this._updateEndPosition()},r.prototype._calcAnchorRow=function(n){for(var u,i,f=0,r=0,e=this._sheet.getRowCount(),t=0;t<e;t++)if(u=this._sheet.getRowHeight(t,3),f+=u,i=f-n,i>0)return r=i>0?u-i:-1,{row:t,offsetY:r};else if(i===0)return r=0,{row:t+1,offsetY:0};return{row:e-1,offsetY:0}},r.prototype._calcAnchorColumn=function(n){for(var u,i,f=0,r=0,e=this._sheet.getColumnCount(),t=0;t<e;t++)if(u=this._sheet.getColumnWidth(t,3),f+=u,i=f-n,i>0)return r=i>0?u-i:-1,{column:t,offsetX:r};else if(i===0)return r=0,{column:t+1,offsetX:0};return{column:e-1,offsetX:0}},r.prototype._trigger=function(n){if(this._sheet&&(this._sheet.triggerFloatingObjectChanged(n),n.propertyName==="isSelected")){var t={sheet:n.sheet,sheetName:n.sheetName,floatingObject:n.floatingObject};this._sheet.triggerFloatingObjectSelectionChanged(t)}},r.prototype._createContentContainer=function(){var n=document.createElement("div"),t=$(n).addClass(a).addClass(o).css(p,w);return t.css(ht,et),n},r}();n.FloatingObject=v;rt=function(n){function t(t,r,u,f,e){n.call(this,t,r,u,f,e);this._content=i}return __extends(t,n),t.prototype.Content=function(n){var t=this;if(arguments.length===0)return t._content;t.owner()?t.owner()._bindToAutoRefresh(function(n){t._content=n})(n):t._content=n;t._trigger({sheet:t.owner(),sheetName:t.owner()?t.owner()._name:"",customFloatingObject:t,propertyName:"content"})},t.prototype.toJSON=function(){var t=n.prototype.toJSON.call(this),i;return t.floatingObjectType=0,i=$("<div><\/div>").append(this.cloneContent()).html(),t.content=i,t},t.prototype.fromJSON=function(t,i){t&&(n.prototype.fromJSON.call(this,t,i),t.content&&(this._content=$(t.content).get(0)))},t.prototype.clone=function(){var n=new t,i=JSON.stringify(this.toJSON());return n.fromJSON(JSON.parse(i)),n._content=this.cloneContent(),n},t.prototype.cloneContent=function(){return this._content?$(this._content).clone().filter("*").removeAttr("id").get(0):i},t.prototype._createContentContainer=function(){var t=document.createElement("div"),s=$(t).addClass(a).addClass(o).css(p,w),n=this.cloneContent(),f=st,e=st,r="",u="",h;return n&&n.style&&(r=n.style.width,u=n.style.height),r!==""&&(f=r),u!==""&&(e=u),n!==i?h=$(n).css({width:f,height:e}).addClass(ti).addClass(o).appendTo(t):s.css(ht,et),t},t}(v);n.CustomFloatingObject=rt;ut=function(r){function u(n,t,u,f,e,o){r.call(this,n,u,f,e,o);var s=this;s._pictureStretch=0;s._borderWidth=1;s._borderStyle="none";s._borderColor=i;s._borderRadius=-1;s._backColor=i;s._imageLoader=i;s._isImageLoaded=!1;s._isTakeOriginalSize=!1;typeof t=="string"&&s.src(t)}return __extends(u,r),u.prototype._trigger=function(n){if(this.owner()&&(n&&n.floatingObject&&(n.picture=n.floatingObject,delete n.floatingObject),this.owner().triggerPictureChanged(n),n.propertyName==="isSelected")){var t={sheet:n.sheet,sheetName:n.sheetName,picture:n.picture};this.owner().triggerPictureSelectionChanged(t)}},u.prototype.backColor=function(n){var t=this,i;return arguments.length===0?t._backColor:(typeof n=="string"&&t._backColor!==n&&(i=t.owner(),i?i._bindToAutoRefresh(function(n){t._backColor=n})(n):t._backColor=n,t._trigger({sheet:i,sheetName:i?i._name:"",picture:t,propertyName:"backColor"})),t)},u.prototype.borderRadius=function(n){var t=this,i;return arguments.length===0?t._borderRadius:(typeof n!="number"||isNaN(n)||t._borderRadius===n||(i=t.owner(),i?i._bindToAutoRefresh(function(n){t._borderRadius=n})(n):t._borderRadius=n,t._trigger({sheet:i,sheetName:i?i._name:"",picture:t,propertyName:"borderRadius"})),t)},u.prototype.borderWidth=function(n){var t=this,i;return arguments.length===0?t._borderWidth:(typeof n!="number"||isNaN(n)||t._borderWidth===n||(i=t.owner(),i?i._bindToAutoRefresh(function(n){t._borderWidth=n})(n):t._borderWidth=n,t._trigger({sheet:i,sheetName:i?i._name:"",picture:t,propertyName:"borderWidth"})),t)},u.prototype.borderStyle=function(n){var t=this,i;return arguments.length===0?t._borderStyle:(typeof n=="string"&&t._borderStyle!==n&&(i=t.owner(),i?i._bindToAutoRefresh(function(n){t._borderStyle=n})(n):t._borderStyle=n,t._isBorderStyleWork(n)||(t._borderWidth=0),t._trigger({sheet:i,sheetName:i?i._name:"",picture:t,propertyName:"borderStyle"})),t)},u.prototype.borderColor=function(n){var t=this,i;return arguments.length===0?t._borderColor:(typeof n=="string"&&t._borderColor!==n&&(i=t.owner(),i?i._bindToAutoRefresh(function(n){t._borderColor=n})(n):t._borderColor=n,t._trigger({sheet:i,sheetName:i?i._name:"",picture:t,propertyName:"borderColor"})),t)},u.prototype.pictureStretch=function(i){var r=this,u;return arguments.length===0?r._pictureStretch:(r._pictureStretch!==i&&n.ImageLayout[i]!==t&&(u=r.owner(),u?u._bindToAutoRefresh(function(n){r._pictureStretch=n})(i):r._pictureStretch=i,r._trigger({sheet:u,sheetName:u?u._name:"",picture:r,propertyName:"pictureStretch"})),r)},u.prototype.getOriginalWidth=function(){return this._originalWidth},u.prototype.getOriginalHeight=function(){return this._originalHeight},u.prototype.src=function(n){var t=this,i;return arguments.length===0?t._src:(typeof n=="string"&&t._src!==n&&(i=t.owner(),i?i._bindToAutoRefresh(function(n){t._src=n})(n):t._src=n,t._trigger({sheet:i,sheetName:i?i._name:"",picture:t,propertyName:"src"}),t._isImageLoaded=!1,t._loadImage()),t)},u.prototype._isDefaultValue=function(n,t){switch(n){case"backColor":return t===i;case"borderRadius":return t===-1;case"borderWidth":return t===1;case"borderStyle":return t==="none";case"borderColor":return t===i;case"pictureStretch":return t===0}return r.prototype._isDefaultValue.call(this,n,t)},u.prototype.toJSON=function(){var i=this,n=r.prototype.toJSON.call(this),u,f,e;n.src=i._src;n.floatingObjectType=1;n.backColor=i._backColor;n.borderRadius=i._borderRadius;n.borderWidth=i._borderWidth;n.borderStyle=i._borderStyle;n.borderColor=i._borderColor;n.pictureStretch=i._pictureStretch;u={};for(f in n)e=n[f],i._isDefaultValue(f,e)||(u[f]=e);return $.isEmptyObject(u)?t:u},u.prototype.fromJSON=function(n,i){if(n){var u=this;r.prototype.fromJSON.call(this,n,i);n.src&&(u._src=n.src,u._isImageLoaded=!1,u._loadImage(),n.backColor!==t&&(u._backColor=n.backColor),n.borderRadius!==t&&(u._borderRadius=n.borderRadius),n.borderWidth!==t&&(u._borderWidth=n.borderWidth),n.borderStyle!==t&&(u._borderStyle=n.borderStyle),n.borderColor!==t&&(u._borderColor=n.borderColor),n.pictureStretch!==t&&(u._pictureStretch=n.pictureStretch))}},u.prototype.clone=function(){var n=new u,t=JSON.stringify(this.toJSON());return n.fromJSON(JSON.parse(t)),n},u.prototype._isBorderStyleWork=function(n){switch(n){case"dotted":case"dashed":case"solid":case"double":case"groove":case"ridge":case"inset":case"outset":return!0;default:return!1}},u.prototype._loadImage=function(){var t=this,i=t._src,r,u;t._imageLoader||(t._imageLoader=new n._GcImageLoader(function(){t._loadImage()}));try{t._imageLoader.getState(i)?(t._isImageLoaded=!0,r=t._imageLoader.getImage(i),t._originalWidth=r.width,t._originalHeight=r.height,t._isTakeOriginalSize&&(t.width(t._originalWidth),t.height(t._originalHeight),t._isTakeOriginalSize=!1),u=t.owner(),u&&u.repaint()):t._imageLoader.addImage(i)}catch(f){}},u.prototype._createContentContainer=function(){var n=document.createElement("div"),t=$(n).addClass(a).addClass(o).css(p,w);return n},u}(v);n.Picture=ut;c=function(){function e(n,t){this._srcCache="";var i=this;i._floatingObject=n;i.name=i._floatingObject.name();i._sheet=t;i._isMouseCapture=!1}return e.prototype.floatingObject=function(){return this._floatingObject},e.prototype.render=function(n,t){var i=this,s=!1,e,r,u,f,h;i._rect=n;i._floatingObjectContainerDiv||(i._floatingObjectContainerDiv=i._createFloatingObjectContainer(i._floatingObject.name()),e=i._sheet.parent,e&&(i._containerDiv=e._getContainerDiv(),i._containerDiv&&$(i._containerDiv).append(i._floatingObjectContainerDiv)));i._floatingObjectContentDiv||(i._floatingObjectContentDiv=i._floatingObject._createContentContainer(),typeof i._floatingObject.borderWidth=="function"?(i._borderDiv=document.createElement("div"),$(i._borderDiv).addClass(o+" "+a),i._floatingObjectContainerDiv.appendChild(i._borderDiv),i._borderDiv.appendChild(i._floatingObjectContentDiv)):(i._floatingObjectContainerDiv.appendChild(i._floatingObjectContentDiv),s=!0));i._borderDiv&&(i._applyBorderStyle(t,n),t.x=0,t.y=0);r=$(i._floatingObjectContainerDiv);u=$(i._floatingObjectContentDiv);r.css({top:n.y,left:n.x,width:n.width,height:n.height});u.css({top:t.y,left:t.x,width:t.width,height:t.height});i._borderDiv&&i._paintImage();i._floatingObject.isSelected()?(u.removeClass(lt).addClass(ct),i._showResizeIndicator(r)):(u.removeClass(ct).addClass(lt),i._hideResizeIndicator(r));s&&(f=i._sheet,h=$(i._floatingObjectContentDiv).children()[0],f.triggerCustomFloatingObjectLoaded({sheet:f,sheetName:f._name,customFloatingObject:i._floatingObject,element:h}))},e.prototype.setFloatingObjectZIndex=function(n){$(this._floatingObjectContainerDiv).css("z-index",n)},e.prototype.getFloatingObjectZIndex=function(){var n=parseInt($(this._floatingObjectContainerDiv).css("z-index"));return isNaN(n)?-1:n},e.prototype._paintImage=function(){var u=this,r=u._floatingObject,e=r.src(),o=r.pictureStretch(),s=n._ThemeContext.getColor(r.owner(),r.backColor()),f;if(e&&u._floatingObjectContentDiv&&(f=$(u._floatingObjectContentDiv),u._srcCache!==e&&(u._srcCache=e,f.css("background-image","url('"+e+"')").css("background-repeat","no-repeat")),f.css("background-color",s),o!==i&&o!==t)&&r._isImageLoaded){var h=r.getOriginalWidth(),c=r.getOriginalHeight(),l=f.width(),a=f.height();n.util._applyBackgroundImageLayout(u._floatingObjectContentDiv,l,a,h,c,o)}},e.prototype._applyBorderStyle=function(t,i){var p=this._borderDiv,f=this._floatingObject,u=f.borderWidth(),a=f.borderStyle(),w=n._ThemeContext.getColor(f.owner(),f.borderColor()),b=f.borderRadius(),o=0,r=s(e._resizeIndicatorSize/2+1);f._isBorderStyleWork(a)||(u=0);u<r&&(o=r-u);var h=o,c=o,v=o,y=o;r=l(u,r);t.x<0?h+=t.x-r:(h+=t.x<r?t.x-r:0,y=i.width-h-t.width-2-2*u);t.y<0?c+=t.y-r:(c+=t.y<r?t.y-r:0,v=i.height-c-t.height-2-2*u);$(p).css({position:"absolute",left:h,top:c,bottom:v,right:y,"border-width":u,"border-style":a,"border-color":w,"border-radius":b})},e.prototype._dispose=function(){var n=this;n._touchManager&&n._touchManager.detach();n._floatingObjectContainerDiv&&($(n._floatingObjectContainerDiv).remove(),n._floatingObjectContainerDiv=i);n._moveResizeContainerDiv&&($(n._moveResizeContainerDiv).remove(),n._moveResizeContainerDiv=i)},e.prototype._showResizeIndicator=function(n){var ft=$(at,n),o,ut;ft.removeClass(b);var t=this,c=t._getHTMLElementBounds(t._floatingObjectContainerDiv),p=t._floatingObjectContentDiv,a=t._floatingObject;t._borderDiv&&(p=t._borderDiv);var u=t._getHTMLElementBounds(p),l=u.x,h=u.y,v=c.height-u.y-u.height,w=c.width-u.x-u.width,r=0,i=e._resizeIndicatorSize,y=i+2,rt=s(i/2+1);typeof a.borderWidth=="function"&&(o=a.borderWidth(),ut=a.borderStyle(),a._isBorderStyleWork(ut)||(o=0),o>=rt&&(r=o-rt),v=c.height-h-u.height-o,w=c.width-l-u.width-o,l+=o,h+=o);l>0?(h>0?$(k,t._floatingObjectContainerDiv).css({top:r,left:r,width:i,height:i}).addClass(f):t._resizeIndicatorUnselect(k),c.height>0?$(d,t._floatingObjectContainerDiv).css({left:r,top:(u.height-y)/2+h,width:i,height:i}).addClass(f):t._resizeIndicatorUnselect(d),v>0?$(g,t._floatingObjectContainerDiv).css({left:r,bottom:r,width:i,height:i}).addClass(f):t._resizeIndicatorUnselect(g)):(t._resizeIndicatorUnselect(k),t._resizeIndicatorUnselect(d),t._resizeIndicatorUnselect(g));h>0?$(vt,t._floatingObjectContainerDiv).css({top:r,left:(u.width-y)/2+l,width:i,height:i}).addClass(f):t._resizeIndicatorUnselect(vt);v>0?$(yt,t._floatingObjectContainerDiv).css({left:(u.width-y)/2+l,bottom:r,width:i,height:i}).addClass(f):t._resizeIndicatorUnselect(yt);w>0?(h>0?$(nt,t._floatingObjectContainerDiv).css({right:r,top:r,width:i,height:i}).addClass(f):t._resizeIndicatorUnselect(nt),c.height>0?$(tt,t._floatingObjectContainerDiv).css({top:(u.height-y)/2+h,right:r,width:i,height:i}).addClass(f):t._resizeIndicatorUnselect(tt),v>0?$(it,t._floatingObjectContainerDiv).css({right:r,bottom:r,width:i,height:i}).addClass(f):t._resizeIndicatorUnselect(it)):(t._resizeIndicatorUnselect(nt),t._resizeIndicatorUnselect(tt),t._resizeIndicatorUnselect(it))},e.prototype._resizeIndicatorUnselect=function(n){$(n,this._floatingObjectContainerDiv).removeClass(f).addClass(b)},e.prototype._hideResizeIndicator=function(n){$(at,n).removeClass(f).addClass(b)},e.prototype._createFloatingObjectContainer=function(t){var r=document.createElement("div"),u=$(r),i=this;return i._renderManager.reduceZIndex(),u.addClass(dt).addClass(o).css("z-index",bt).bind("mousedown",function(n){i._doMouseDown(n)}).bind("mousemove",function(n){i._doMouseMove(n)}).bind("mouseup",function(n){i._doMouseUp(n)}),r.addEventListener("mousewheel",function(n){i._doMouseWheel(n)},!1),r.addEventListener("DOMMouseScroll",function(n){i._doMouseWheel(n)},!1),u.append($(ii)),n.features.touch&&(i._touchManager=new n.FloatingObjectTouchManager(r,i,i._sheet.parent._touchEventProvider),i._touchManager.attach()),r},e.prototype._createMoveResizeContainer=function(){var n=this,s,f,i,r,t,h,e,o,c,u;if(n._floatingObjectContainerDiv&&n._layout&&!n._moveResizeDiv){for(n._moveResizeContainerDiv=document.createElement("div"),n._moveResizeDiv=document.createElement("div"),n._attachedMoveResizeDivDict={},s=n._renderManager._containerArray.length,f=0;f<s;f++)i=n._renderManager._containerArray[f],r=i._floatingObject,r&&r.name()!==n._floatingObject.name()&&r.isSelected()&&!n._attachedMoveResizeDivDict[r.name()]&&(n._attachedMoveResizeDivDict[r.name()]={offsetX:i._layout.x-n._layout.x,offsetY:i._layout.y-n._layout.y,height:i._layout.height,width:i._layout.width,moveResizeDiv:document.createElement("div")});t=n._getViewportRect(n._rowViewportIndex,n._columnViewportIndex);h=$(n._moveResizeContainerDiv);h.addClass(gt).css("z-index",kt).css({top:t.y,left:t.x,width:t.width,height:t.height}).bind("mousemove",function(t){n._doMouseMove(t)}).bind("mouseup",function(t){n._doMouseUp(t)});e=n._layout.y-t.y;o=n._layout.x-t.x;n._attachMoveResizeDivToContainer(n._moveResizeDiv,n._moveResizeContainerDiv,o,e,n._layout.width,n._layout.height);for(c in n._attachedMoveResizeDivDict)u=n._attachedMoveResizeDivDict[c],n._attachMoveResizeDivToContainer(u.moveResizeDiv,n._moveResizeContainerDiv,o+u.offsetX,e+u.offsetY,u.width,u.height);n._containerDiv&&$(n._containerDiv).append(n._moveResizeContainerDiv)}},e.prototype._handleDocumentMouseMove=function(){var n=this;n._isMouseCapture||($(document).bind("mousemove.gcSheet",function(t){n._doMouseMove(t)}),$(document).bind("mouseup.gcSheet",function(t){n._doMouseUp(t)}),n._isMouseCapture=!0)},e.prototype._unhandleDocumentMouseMove=function(){this._isMouseCapture&&(this._isMouseCapture=!1,$(document).unbind("mousemove.gcSheet"),$(document).unbind("mouseup.gcSheet"))},e.prototype._doMouseDown=function(t){var i=this,r=i._sheet,u,o,s,f,e;if((!r.isProtected||!i._floatingObject.isLocked())&&r.endEdit()){if(i._touchManager&&!t.isTouch&&i._touchManager.preProcessMouseDown(t)){n.util.cancelDefault(t);return}if(t.button===0||t.button===2){if(t.ctrlKey||t.shiftKey?i._floatingObject.isSelected()?i._floatingObject.isSelected(!1):(i._floatingObject.isSelected(!0),n.FocusHelper.setActiveElement(r)):i._floatingObject.isSelected()||(r.unSelectAllFloatingObjects(),i._floatingObject.isSelected(!0),n.FocusHelper.setActiveElement(r)),r._commentManager&&r._commentManager.deactivateComment(),r._saveAndClearSheetSelections(),t.button===2)return;u=r._eventHandler;o=u._getCanvasOffset();i._mouseLeftButtonDownPosition=new n.Point(t.pageX-o.left,t.pageY-o.top);i._mousePosition=i._mouseLeftButtonDownPosition;i._isMouseLeftButtonDown=!0;i._mouseDownHittestInfo=i._hitTest(i._mousePosition.x,i._mousePosition.y);i._mouseDownHittestInfo.inMoving?(i._moveInfo={},i._moveInfo.startTopRow=r.getViewportTopRow(i._rowViewportIndex),i._moveInfo.startLeftColumn=r.getViewportLeftColumn(i._columnViewportIndex)):(i._createMoveResizeContainer(),s=$(i._moveResizeDiv),i._resizeInfo={},f=i._getHTMLElementBounds(i._moveResizeDiv),i._resizeInfo.startX=f.x,i._resizeInfo.startY=f.y,i._resizeInfo.startWidth=f.width,i._resizeInfo.startHeight=f.height,i._resizeInfo.startTopRow=r.getViewportTopRow(i._rowViewportIndex),i._resizeInfo.startLeftColumn=r.getViewportLeftColumn(i._columnViewportIndex));i._handleDocumentMouseMove();e=r.hitTest(i._mousePosition.x,i._mousePosition.y);u.startHitInfo={scrollRowViewportIndex:e.rowViewportIndex,scrollColViewportIndex:e.colViewportIndex,hitTestType:e.hitTestType};u.mousePosition=i._mousePosition;u.startScroll();u.isFloatingObjectWorking=!0}return t.stopPropagation(),!1}},e.prototype._doMouseMove=function(t){var i=this,u=i._sheet,e;if(!u.isProtected||!i._floatingObject.isLocked()){if(i._touchManager&&!t.isTouch&&i._touchManager.preProcessMouseMove(t)){n.util.cancelDefault(t);return}if(u._isMouseDownInSheet)return i._floatingObjectContainerDiv&&(e=$(i._floatingObjectContainerDiv),e.css("cursor","default")),!0;var f=u._eventHandler,s=f._getCanvasOffset(),r=new n.Point(t.pageX-s.left,t.pageY-s.top);return i._isMouseLeftButtonDown?($(i._moveResizeContainerDiv).css("cursor",$(i._floatingObjectContainerDiv).css("cursor")),i._mouseDownHittestInfo.inMoving?(i._isMoving=!0,i._createMoveResizeContainer(),i._doMoveContainer(i._mousePosition,r)):(i._isResizing=!0,i._doResizeContainer(i._mousePosition,i._mouseDownHittestInfo)),i._mousePosition=r,f.mousePosition=r,f.continueScroll(),$(document.body).addClass(o)):i._updateCursor(r),t.stopPropagation(),!1}},e.prototype._doMouseUp=function(t){var i=this,r=i._sheet,u=r._eventHandler,s,f,e;if(!r.isProtected||!i._floatingObject.isLocked()){if(i._touchManager&&!t.isTouch&&i._touchManager.preProcessMouseUp(t)){n.util.cancelDefault(t);return}return r._isMouseDownInSheet?(i._floatingObjectContainerDiv&&(s=$(i._floatingObjectContainerDiv),s.css("cursor","move")),!0):(u.isFloatingObjectWorking=!1,u.stopScroll(),f=u._getCanvasOffset(),e=new n.Point(t.pageX-f.left,t.pageY-f.top),i._mouseDownHittestInfo&&(i._mouseDownHittestInfo.inMoving&&i._isMoving?t.ctrlKey?i._doCopyFloatingObject(i._mouseLeftButtonDownPosition,e):i._doMoveFloatingObject(i._mouseLeftButtonDownPosition,e):i._isResizing&&i._doResizeFloatingObject(),$(document.body).removeClass(o)),i._resetStatusOnMouseUp(),t.stopPropagation(),!1)}},e.prototype._resetStatusOnMouseUp=function(){var n=this;n._resizeInfo=i;n._moveInfo=i;n._attachedMoveResizeDivDict=i;$(n._moveResizeContainerDiv).remove();n._moveResizeDiv=i;n._isMouseLeftButtonDown=!1;n._unhandleDocumentMouseMove();n._isMoving=!1;n._isResizing=!1},e.prototype._doMouseWheel=function(t){var i=this._sheet,r;if(i)return t=t?t:window.event,r=t.detail?t.detail:t.wheelDelta/-40,i._eventHandler.doMouseWheel(t,parseInt(r,10)),n.util.cancelDefault(t),!1},e.prototype._doCopyFloatingObject=function(t,i){var r=this,u=r._sheet,s,h;if(r._moveInfo){var e=r._getTwoRowDistance(r._moveInfo.startTopRow,u.getViewportTopRow(r._rowViewportIndex)),o=r._getTwoColumnDistance(r._moveInfo.startLeftColumn,u.getViewportLeftColumn(r._columnViewportIndex)),c=i.x-t.x+(i.x>t.x?o:-1*o),l=i.y-t.y+(i.y>t.y?e:-1*e),f=[];f.push(r._floatingObject.name());for(s in r._attachedMoveResizeDivDict)f.push(s);h=new n.UndoRedo.DragCopyFloatingObjectUndoAction(u,{names:f},{offsetX:c,offsetY:l});u._doCommand(h)}},e.prototype._doMoveFloatingObject=function(t,i){var r=this,u=r._sheet,f,c,l;if(r._moveInfo){var s=r._getTwoRowDistance(r._moveInfo.startTopRow,u.getViewportTopRow(r._rowViewportIndex)),h=r._getTwoColumnDistance(r._moveInfo.startLeftColumn,u.getViewportLeftColumn(r._columnViewportIndex)),e=i.x-t.x+(i.x>t.x?h:-1*h),o=i.y-t.y+(i.y>t.y?s:-1*s);e=e/u._zoomFactor;o=o/u._zoomFactor;f=[];f.push(r._floatingObject.name());for(c in r._attachedMoveResizeDivDict)f.push(c);l=new n.UndoRedo.MovingFloatingObjectUndoAction(u,{names:f},{offsetX:e,offsetY:o});u._doCommand(l)}},e.prototype._doResizeFloatingObject=function(){var t=this,i=t._sheet,r=i._zoomFactor,u,h,c;if(t._resizeInfo){var f=t._getTwoRowDistance(t._resizeInfo.startTopRow,i.getViewportTopRow(t._rowViewportIndex)),e=t._getTwoColumnDistance(t._resizeInfo.startLeftColumn,i.getViewportLeftColumn(t._columnViewportIndex)),o=t._resizeInfo.endX-t._resizeInfo.startX+(t._resizeInfo.endX>t._resizeInfo.startX?e:-1*e);o=o/r;u=t._resizeInfo.endY-t._resizeInfo.startY+(t._resizeInfo.endY>t._resizeInfo.startY?f:-1*f);u=u/r;var l=(t._resizeInfo.endWidth+e)/r-t._floatingObject.width(),a=(t._resizeInfo.endHeight+f)/r-t._floatingObject.height(),s=[];s.push(t._floatingObject.name());for(h in t._attachedMoveResizeDivDict)s.push(h);c=new n.UndoRedo.ResizingFloatingObjectUndoAction(i,{names:s},{offsetX:o,offsetY:u,offsetWidth:l,offsetHeight:a});i._doCommand(c)}},e.prototype._doMoveContainer=function(n,t){var i=this,f,e;if(i._moveResizeDiv){var o=$(i._moveResizeDiv),r=t.x-n.x,u=t.y-n.y;i._doMoveContainerImp(i._moveResizeDiv,r,u);for(f in i._attachedMoveResizeDivDict)e=i._attachedMoveResizeDivDict[f],i._doMoveContainerImp(e.moveResizeDiv,r,u)}},e.prototype._doMoveContainerImp=function(n,t,i){var r=$(n),u=r.position();r.css({top:u.top+i,left:u.left+t})},e.prototype._doResizeContainer=function(t,i){var r,u,e,l,a;if(i){r=this;e=r._getViewportRect(r._rowViewportIndex,r._columnViewportIndex);t=new n.Point(t.x-e.x,t.y-e.y);i.inTopNWSEResizing?u=r._getFloatingObjectTopLeftResizingRect(t):i.inTopNSResizing?u=r._getFloatingObjectTopCenterResizingRect(t):i.inTopNESWResizing?u=r._getFloatingObjectTopRightResizingRect(t):i.inLeftWEResizing?u=r._getFloatingObjectMiddleLeftResizingRect(t):i.inRightWEResizing?u=r._getFloatingObjectMiddleRightResizingRect(t):i.inBottomNESWResizing?u=r._getFloatingObjectBottomLeftResizingRect(t):i.inBottomNSReszing?u=r._getFloatingObjectBottomCenterResizingRect(t):i.inBottomNWSEReszing&&(u=r._getFloatingObjectBottomRightResizingRect(t));r._resizeInfo.endX=u.x;r._resizeInfo.endY=u.y;r._resizeInfo.endWidth=u.width;r._resizeInfo.endHeight=u.height;var v=$(r._moveResizeDiv),f=r._getHTMLElementBounds(r._moveResizeDiv),o=u.y-f.y,s=u.x-f.x,h=u.width-f.width,c=u.height-f.height;r._doResizeContainerImp(r._moveResizeDiv,s,o,h,c);for(l in r._attachedMoveResizeDivDict)a=r._attachedMoveResizeDivDict[l],r._doResizeContainerImp(a.moveResizeDiv,s,o,h,c)}},e.prototype._doResizeContainerImp=function(n,t,i,r,u){var e=$(n),f=this._getHTMLElementBounds(n);e.css({top:f.y+i,left:f.x+t,width:f.width+r,height:f.height+u})},e.prototype._attachMoveResizeDivToContainer=function(n,t,i,r,u,f){$(n).addClass(ni).css({top:r-1,left:i-1,width:u,height:f}).appendTo(t)},e.prototype._getHTMLElementBounds=function(t){var i=$(t),r=i.position();return new n.Rect(r.left,r.top,i.width(),i.height())},e.prototype._updateCursor=function(n){var r=this,u,t,f;r._floatingObjectContainerDiv&&(u=$(r._floatingObjectContainerDiv),t=r._hitTest(n.x,n.y),t!==i&&(f=t.inTopNWSEResizing?"nw-resize":t.inTopNSResizing?"n-resize":t.inTopNESWResizing?"ne-resize":t.inLeftWEResizing?"w-resize":t.inRightWEResizing?"w-resize":t.inBottomNESWResizing?"sw-resize":t.inBottomNSReszing?"n-resize":t.inBottomNWSEReszing?"se-resize":"move",u.css("cursor",f)))},e.prototype._getFloatingObjectTopLeftResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX+i._resizeInfo.startWidth,t.x),e=r(i._resizeInfo.startY+i._resizeInfo.startHeight,t.y),o=u(t.x-i._resizeInfo.startX-i._resizeInfo.startWidth),s=u(t.y-i._resizeInfo.startY-i._resizeInfo.startHeight);return new n.Rect(f,e,o,s)},e.prototype._getFloatingObjectTopCenterResizingRect=function(t){var i=this,f=i._resizeInfo.startX,e=r(i._resizeInfo.startY+i._resizeInfo.startHeight,t.y),o=u(t.y-i._resizeInfo.startY-i._resizeInfo.startHeight),s=i._resizeInfo.startWidth;return new n.Rect(f,e,s,o)},e.prototype._getFloatingObjectTopRightResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX,t.x),e=r(i._resizeInfo.startY+i._resizeInfo.startHeight,t.y),o=u(t.x-i._resizeInfo.startX),s=u(t.y-i._resizeInfo.startY-i._resizeInfo.startHeight);return new n.Rect(f,e,o,s)},e.prototype._getFloatingObjectMiddleLeftResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX+i._resizeInfo.startWidth,t.x),e=i._resizeInfo.startY,o=u(t.x-i._resizeInfo.startX-i._resizeInfo.startWidth),s=i._resizeInfo.startHeight;return new n.Rect(f,e,o,s)},e.prototype._getFloatingObjectMiddleRightResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX,t.x),e=i._resizeInfo.startY,o=u(t.x-i._resizeInfo.startX),s=i._resizeInfo.startHeight;return new n.Rect(f,e,o,s)},e.prototype._getFloatingObjectBottomLeftResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX+i._resizeInfo.startWidth,t.x),e=r(i._resizeInfo.startY,t.y),o=u(t.x-i._resizeInfo.startX-i._resizeInfo.startWidth),s=u(t.y-i._resizeInfo.startY);return new n.Rect(f,e,o,s)},e.prototype._getFloatingObjectBottomCenterResizingRect=function(t){var i=this,f=i._resizeInfo.startX,e=r(i._resizeInfo.startY,t.y),o=u(t.y-i._resizeInfo.startY),s=i._resizeInfo.startWidth;return new n.Rect(f,e,s,o)},e.prototype._getFloatingObjectBottomRightResizingRect=function(t){var i=this,f=r(i._resizeInfo.startX,t.x),e=r(i._resizeInfo.startY,t.y),o=u(t.x-i._resizeInfo.startX),s=u(t.y-i._resizeInfo.startY);return new n.Rect(f,e,o,s)},e.prototype._getViewportRect=function(n,t){var w=this,i=w._sheet,u=i._getSheetLayout(),r=u.viewportRect(n,t),e,o,s,c,f,l=w._floatingObject,b=l.startRow(),k=l.startColumn(),d=l.endRow(),g=l.endColumn(),a=i.frozenRowCount,v=i.frozenColCount,y=i.getRowCount(3)-i.getFrozenTrailingRowCount()-1,p=i.getColumnCount(3)-i.getFrozenTrailingColumnCount()-1;return n===h?(a>0&&(e=i.getViewportTopRow(n),(b<a||e===a)&&(r.y-=u.frozenHeight,r.height+=u.frozenHeight)),i._frozenTrailingRowCount>0&&(o=i.getViewportBottomRow(n),d>y&&o===y&&(r.height+=u.frozenTrailingHeight))):n===h-1?(e=i.getViewportTopRow(n+1),(d>=e||e===a)&&(f=u.viewportRect(n+1,t),r.height+=f.height)):n===h+1&&(o=i.getViewportBottomRow(n-1),(b<=o||o===y)&&(f=u.viewportRect(n-1,t),r.y=f.y,r.height+=f.height)),t===h?(v>0&&(s=i.getViewportLeftColumn(t),(k<v||s===v)&&(r.x-=u.frozenWidth,r.width+=u.frozenWidth)),i._frozenTrailingColCount>0&&(c=i.getViewportRightColumn(t),(g>p||c===p)&&(r.width+=u.frozenTrailingWidth))):t===h-1?(s=i.getViewportLeftColumn(t+1),(g>=s||s===v)&&(f=u.viewportRect(n,t+1),r.width+=f.width)):t===h+1&&(c=i.getViewportRightColumn(t-1),(k<=c||c===p)&&(f=u.viewportRect(n,t-1),r.x=f.x,r.width+=f.width)),r},e.prototype._getTwoColumnDistance=function(n,t){for(var f=r(n,t),e=l(n,t),u=0,i=f;i<e;i++)u+=this._sheet.getColumnWidth(i,3);return u},e.prototype._getTwoRowDistance=function(n,t){for(var f=r(n,t),e=l(n,t),u=0,i=f;i<e;i++)u+=this._sheet.getRowHeight(i,3);return u},e.prototype._hitTest=function(t,r){var o=this,f,y,p,w,b,k,d,g,nt;if(!o._layout)return i;if(f={inMoving:!1,inTopNWSEResizing:!1,inTopNSResizing:!1,inTopNESWResizing:!1,inLeftWEResizing:!1,inRightWEResizing:!1,inBottomNESWResizing:!1,inBottomNSReszing:!1,inBottomNWSEReszing:!1},!o._floatingObject.isSelected())return f.inMoving=!0,f;var u=s(e._resizeIndicatorSize/2+1),l=10,h=o._layout.x,c=o._layout.y,a=o._layout.width,v=o._layout.height;return(o._floatingObject&&o._floatingObject.isSelected()&&(h-=u,c-=u,a+=2*u,v+=2*u),y=o._inflateRect(new n.Rect(h,c,u,u),l),y.contains(t,r))?(f.inTopNWSEResizing=!0,f):(p=o._inflateRect(new n.Rect(h+a/2-u,c,2*u,u),l),p.contains(t,r))?(f.inTopNSResizing=!0,f):(w=o._inflateRect(new n.Rect(h+a-u,c,u,u),l),w.contains(t,r))?(f.inTopNESWResizing=!0,f):(b=o._inflateRect(new n.Rect(h,c+v/2-u,u,2*u),l),b.contains(t,r))?(f.inLeftWEResizing=!0,f):(k=o._inflateRect(new n.Rect(h+a-u,c+v/2-u,u,2*u),l),k.contains(t,r))?(f.inRightWEResizing=!0,f):(d=o._inflateRect(new n.Rect(h,c+v-u,u,u),l),d.contains(t,r))?(f.inBottomNESWResizing=!0,f):(g=o._inflateRect(new n.Rect(h+a/2-u,c+v-u,2*u,u),l),g.contains(t,r))?(f.inBottomNSReszing=!0,f):(nt=o._inflateRect(new n.Rect(h+a-u,c+v-u,u,u),l),nt.contains(t,r))?(f.inBottomNWSEReszing=!0,f):(f.inMoving=!0,f)},e.prototype._inflateRect=function(t,i){var f=t.x-i,e=t.y-i,r=t.width+2*i,u=t.height+2*i;return new n.Rect(f,e,r>=0?r:0,u>=0?u:0)},e._resizeIndicatorSize=7,e}();n._FloatingObjectRender=c;wt=function(){function t(n){this._sheet=n;this._containerArray=new y}return t.prototype.getFloatingObjectRenderCount=function(){return this._containerArray.length},t.prototype._dispose=function(){for(var t=this._containerArray.length,n=0;n<t;n++)this._containerArray[n]._dispose();this._containerArray.length=0},t.prototype._render=function(t,r,u){var it,st,lt,rt,at,y,vt;if(!(t<0)&&!(r<0)){for(var o=this,k=o._sheet,et=o._createViewportFloatingObjectLayoutModel(t,r,u),ot=[],f=0,tt=o._containerArray.length;f<tt;f++)et.find(o._containerArray[f].name)||ot.push(o._containerArray[f]);for(f=0,tt=ot.length;f<tt;f++)it=ot[f],it._renderManager=i,o._containerArray.remove(it.name),it._dispose();if(st=et.length,!(st<=0))for(lt=k.parent&&k.parent.useTouchLayout(),c._resizeIndicatorSize=lt?11:7,f=0;f<st;f++){var h=et[f],d=k._findFloatingObjectInternal(h.name),e=s(c._resizeIndicatorSize/2+1);d&&typeof d.borderWidth=="function"&&(rt=d.borderWidth(),at=d.borderStyle(),d._isBorderStyleWork(at)||(rt=0),rt>e&&(e=rt));var w=o._getViewportRect(t,r),p=1,g=h.x-e-p,nt=h.y-e-p,yt=h.width+2*e+2*p,pt=h.height+2*e+2*p,ht=l(w.y,nt),ct=l(w.x,g),ut=pt,ft=yt,a=e+p,v=e+p,b=-1*e-p;nt<=0&&(a+=nt<b?b:nt);g<=0&&(v+=g<b?b:g);a=nt-ht+a;v=g-ct+v;a<=0?(ut+=a,ut+=b):a<e&&a>0&&(ut-=e-a);v<=0?(ft+=v,ft+=b):v<e&&v>0&&(ft-=e-v);y=o._containerArray.find(h.name);y||(y=new c(k._findFloatingObjectInternal(h.name),k),y._renderManager=o,o._containerArray.push(y));y._layout=h;y._rowViewportIndex=t;y._columnViewportIndex=r;vt=new n.Rect(w.x,w.y,w.width,w.height);y.render(new n.Rect(ct,ht,ft,ut).getIntersectRect(vt)||new n.Rect(ct,ht,0,0),new n.Rect(v,a,h.width,h.height))}}},t.prototype.setFloatingObjectZIndex=function(n,t){var i=this._containerArray.find(n);i&&i.setFloatingObjectZIndex(t)},t.prototype.getFloatingObjectZIndex=function(n){var t=this._containerArray.find(n);return t?t.getFloatingObjectZIndex():-1},t.prototype.reduceZIndex=function(){for(var t,i,r=this._containerArray,n=0,u=r.length;n<u;n++)t=r[n],i=t.getFloatingObjectZIndex(),i!==-1&&t.setFloatingObjectZIndex(i-1)},t.prototype._getViewportRect=function(t,i){var f=this._sheet,u=f._getViewportColumnLayout(i),e=0,o=0,c=0,l=0,a,s,r,v,h,y,p;return u&&u.length>0&&(a=u[0],s=u[u.length-1],e=a.x,c=s.x+s.width-e),r=f._getViewportRowLayout(t),r&&r.length>0&&(v=r[0],h=r[r.length-1],o=v.y,l=h.y+h.height-o),y=f._getSheetLayout(),p=y.viewportRect(t,i),p.getIntersect(e,o,c,l)||new n.Rect(0,0,0,0)},t.prototype._createViewportFloatingObjectLayoutModel=function(n,t,i){var ht=this,o=ht._sheet,l=new y,e=o._floatingObjectArray,ct=e.length,v,r,w,b,d,g,ot,st;if(e.length===0)return l;e.isNeedToUpdateLayout&&(e._updateFloatingsObjectlayoutOnColumnRowChanged(),e.isNeedToUpdateLayout=!1);var lt=o._getSheetLayout(),a=o._cachePool,h=o._getViewportColumnLayout(t),c=o._getViewportRowLayout(n);if(h.length<=0||c.length<=0)return l;var nt=h[0],it=h[h.length-1],tt=c[0],rt=c[c.length-1];for(v=0;v<ct;v++)if(r=e[v],r.isVisible()){var u=0,p=r.startColumn(),ut=h.findCol(p);if(ut)u=ut.x;else if(p<nt.col)for(u=nt.x,w=nt.col-1;w>=p;w--)u-=a.getZoomColWidth(w);else for(u=it.x,b=it.col+1;b<=p;b++)u+=a.getZoomColWidth(b);u+=r.startColumnOffset()*i;var f=0,k=r.startRow(),et=c.findRow(k);if(et)f=et.y;else if(k<tt.row)for(f=tt.y,d=tt.row-1;d>=k;d--)f-=a.getZoomRowHeight(d);else for(f=rt.y,g=rt.row+1;g<=k;g++)f+=a.getZoomRowHeight(g);f+=r.startRowOffset()*i;ot=s(r.width()*i);st=s(r.height()*i);l.push(new ft(r.name(),u,f,ot,st))}return l},t}();n._FloatingObjectRenderManager=wt;ft=function(){function n(n,t,i,r,u){var f=this;f.name=n;f.x=t;f.y=i;f.height=u;f.width=r}return n}();n._FloatingObjectLayout=ft;y=function(n){function t(){n.call(this)}return __extends(t,n),t.prototype.remove=function(n){for(var t=0;t<this.length;t++)if(this[t].name===n){this.splice(t,1);return}},t.prototype.find=function(n){for(var t=0;t<this.length;t++)if(this[t].name===n)return this[t];return i},t.prototype.findByPropertyName=function(n){for(var t=0;t<this.length;t++)if(this[t]._name===n)return this[t];return i},t}(n._XArray);n.NamedObjectArray=y})(n.Sheets||(n.Sheets={}));var t=n.Sheets})(GcSpread||(GcSpread={}))
